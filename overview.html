<!DOCTYPE html>
<html class="no-js" lang="en" data-content_root="./">
<head>
    <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>Gupje overview &mdash; Gupje  documentation</title>
    
    <link rel="stylesheet" type="text/css" href="_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="_static/dist/theme.css?v=310cf088" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/drawio.css" />
            <link rel="index" title="Index" href="genindex.html" />
            <link rel="search" title="Search" href="search.html" />
            <link rel="top" title="Gupje  documentation" href="#" />
            <link rel="next" title="Getting Started" href="getting_started.html" />
            <link rel="prev" title="Gupje Architecture based debugger" href="index.html" />
    </head>
<body>
    <script type="text/javascript" src="_static/dist/blocking.js"></script>
    <header class="container-fluid bg-primary">
        <a class="btn btn-sm btn-light skip-to-content-link" href="#main">Skip to content</a>
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="/"
                        title="Gupje"
                        class="logo navbar-brand"
                    >
                        <img src="_static/img/wagtail-logo-circle.svg" width="45" height="59" alt="Gupje"
                            class="logo-img"
                        />
                        Gupje
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" class="searchbox mb-6 px-1" role="search">
    <form id="search-form" action="search.html" autocomplete="off" method="get" role="search">
        <div class="input-group">
            <div class="input-group-prepend">
                <div class="input-group-text border-right-0 bg-white py-3 pl-3 pr-2"><span class="fas fa-search"></span></div>
            </div>
            <input class="form-control py-3 pr-3 pl-1 h-100 border-left-0" type="search" name="q" placeholder="Search documentation" aria-label="Search documentation" id="searchinput" />
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
    </form>
</div><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Setup:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Gupje overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting Started</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Example Targets:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="targets/rpi4.html">Raspberry Pi 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="targets/nvidia_shield.html">Nvidia Shield Tablet</a></li>
<li class="toctree-l1"><a class="reference internal" href="targets/samsung_s7.html">Samsung S7</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Architectures:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="architectures/arm64/index.html">ARM64</a></li>
<li class="toctree-l1"><a class="reference internal" href="architectures/arm/index.html">ARM</a></li>
<li class="toctree-l1"><a class="reference internal" href="architectures/arm_thumb/index.html">ARM Thumb Mode</a></li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="index.html">Docs</a></li>
        <li class="breadcrumb-item active" aria-current="page">Gupje overview</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="wagtail-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/wagtail/sphinx_wagtail_theme/blob/main/docs/overview.rst" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="_sources/overview.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main" id="main">
    <section id="gupje-overview">
<h1>Gupje overview<a class="headerlink" href="#gupje-overview" title="Link to this heading">¶</a></h1>
<p>Gupje is a stub debugger that is designed to be minimal and requires 3 pages(0x1000) of data to be loaded on a target system.
A high level overview of how the memory mapping for this works is shown below.</p>
<figure class="align-default">
<img alt="_images/gupje_overview.drawio.svg" src="_images/gupje_overview.drawio.svg" />
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the future the debugger will probably grow to 4 pages, to include an extra page for the debugger to use in custom functionality.</p>
</div>
<section id="inner-workings">
<h2>Inner workings<a class="headerlink" href="#inner-workings" title="Link to this heading">¶</a></h2>
<p>When the debugger is entered it will save the state of the processor into it’s storage page. This is done in assembly and is architecture dependent.
When a new architecture is added the first thing that needs to be done is to implement these functionalities.</p>
<figure class="align-default">
<img alt="_images/debugger_flow.drawio.svg" src="_images/debugger_flow.drawio.svg" />
</figure>
<p>The debugger will then wait for commands from the host. The host can send commands to the debugger to read/write memory, jump to an address, etc.</p>
<p>When the user is done it will send the <code class="docutils literal notranslate"><span class="pre">REST</span></code> command to the debugger. This will restore the state of the processor and jump to the address defined in <code class="docutils literal notranslate"><span class="pre">DEBUGGER_JUMP</span></code>.</p>
<p>The debugger also uses a stack that is defined in the debugger. This is done to not taint the original stack of the processor.</p>
</section>
<section id="api">
<h2>API<a class="headerlink" href="#api" title="Link to this heading">¶</a></h2>
<p>The debugger has a simple API that is used to communicate with the device. The following commands are supported:</p>
<section id="memory-read-peek">
<h3>Memory Read(Peek)<a class="headerlink" href="#memory-read-peek" title="Link to this heading">¶</a></h3>
<p>Read an address in memory to the host.</p>
<p>The packet that is send is always 12 bytes, but depending on the address space(32/64 bit) the address will be 4 or 8 bytes. The last 4 bytes are the amount of bytes to read.</p>
<figure class="align-default">
<img alt="_images/peek_cmd.drawio.svg" src="_images/peek_cmd.drawio.svg" />
</figure>
</section>
<section id="memory-write-poke">
<h3>Memory Write(Poke)<a class="headerlink" href="#memory-write-poke" title="Link to this heading">¶</a></h3>
<p>Write a buffer to an address in memory.</p>
</section>
<section id="get-debugger-main-self">
<h3>Get debugger main(SELF)<a class="headerlink" href="#get-debugger-main-self" title="Link to this heading">¶</a></h3>
<p>Get the main entry point of the debugger. This is used to jump to only the debugger without setting up the stack and registers again.
This taints the device but is very usefull for debugging and showing where the debugger is in memory.</p>
</section>
<section id="concrete-main-main">
<h3>Concrete main(MAIN)<a class="headerlink" href="#concrete-main-main" title="Link to this heading">¶</a></h3>
<p>Execute the <code class="docutils literal notranslate"><span class="pre">concrete_main</span></code> function. This function is fully user customizable and can be used to implement custom functionality.
Like executing boot stages in a Qualcomm bootROM.</p>
</section>
<section id="flush-cache-flsh">
<h3>Flush Cache(FLSH)<a class="headerlink" href="#flush-cache-flsh" title="Link to this heading">¶</a></h3>
<p>Execute architecture specific instructions in order to flush the cache.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Only arm64 is supported for this function. The support is there for arm and thumb but not implemented. Probably there will be a change here to support data/code cache flushes.</p>
</div>
</section>
<section id="jump-to-address-jump">
<h3>Jump to address(JUMP)<a class="headerlink" href="#jump-to-address-jump" title="Link to this heading">¶</a></h3>
<p>Simple function that will just jump to an address without restoring the stack or registers. Usefull for testing the debugger or relocating it.</p>
</section>
<section id="dump-special-registers-spec">
<h3>Dump special registers(SPEC)<a class="headerlink" href="#dump-special-registers-spec" title="Link to this heading">¶</a></h3>
<p>Will dump the special registers to the host. This is architecture dependent and will only dump the registers that are supported. For ARM64 checks for each exception level are implemented.</p>
</section>
<section id="synchronize-state-sync">
<h3>Synchronize State(SYNC)<a class="headerlink" href="#synchronize-state-sync" title="Link to this heading">¶</a></h3>
<p>This function can be called from the debugger and will force write the registers from the saved state into the processor.</p>
</section>
<section id="sync-special-syns">
<h3>Sync Special(SYNS)<a class="headerlink" href="#sync-special-syns" title="Link to this heading">¶</a></h3>
<p>Will force write the special registers from the saved state into the processor. Usefull for overwriting the <code class="docutils literal notranslate"><span class="pre">VBAR_ELN</span></code> and others.
Not all registers are supported here and in the future this will probably be changed to be code pushed from the host to save space and support all special registers.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This function is currently only properly implemented for ARM64.</p>
</div>
</section>
<section id="restore-and-jump-rest">
<h3>Restore and Jump(REST)<a class="headerlink" href="#restore-and-jump-rest" title="Link to this heading">¶</a></h3>
<p>This function restores the state of the processor from it’s internal storage and jump’s to the address defined in <code class="docutils literal notranslate"><span class="pre">DEBUGGER_JUMP</span></code>.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Currently there is always a register corrupted on the jump function(we need to branch to a register). I have not found a good method to mitigate this(maybe ldr pc in arm/thumb but wont work for arm64)</p>
</div>
</section>
<section id="restore-and-return-rret">
<h3>Restore and Return(RRET)<a class="headerlink" href="#restore-and-return-rret" title="Link to this heading">¶</a></h3>
<p>Does the same as <code class="docutils literal notranslate"><span class="pre">Restore</span> <span class="pre">and</span> <span class="pre">Jump</span></code> but instead of jumping it returns to the address that called the debugger(LR).</p>
</section>
</section>
<section id="glitching">
<h2>Glitching<a class="headerlink" href="#glitching" title="Link to this heading">¶</a></h2>
<p>A debug flag is added for adding glitching to the debugger. The command <code class="docutils literal notranslate"><span class="pre">GLIT</span></code> will jump to the glitch function but this is not very well implemented yet.
The goal is to add several testable glitch cases to the debugger for profiling.</p>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="index.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>Gupje Architecture based debugger
    </a>
    <a class="float-right" href="getting_started.html" title="Next">
        Getting Started <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Gupje overview</a><ul>
<li><a class="reference internal" href="#inner-workings">Inner workings</a></li>
<li><a class="reference internal" href="#api">API</a><ul>
<li><a class="reference internal" href="#memory-read-peek">Memory Read(Peek)</a></li>
<li><a class="reference internal" href="#memory-write-poke">Memory Write(Poke)</a></li>
<li><a class="reference internal" href="#get-debugger-main-self">Get debugger main(SELF)</a></li>
<li><a class="reference internal" href="#concrete-main-main">Concrete main(MAIN)</a></li>
<li><a class="reference internal" href="#flush-cache-flsh">Flush Cache(FLSH)</a></li>
<li><a class="reference internal" href="#jump-to-address-jump">Jump to address(JUMP)</a></li>
<li><a class="reference internal" href="#dump-special-registers-spec">Dump special registers(SPEC)</a></li>
<li><a class="reference internal" href="#synchronize-state-sync">Synchronize State(SYNC)</a></li>
<li><a class="reference internal" href="#sync-special-syns">Sync Special(SYNS)</a></li>
<li><a class="reference internal" href="#restore-and-jump-rest">Restore and Jump(REST)</a></li>
<li><a class="reference internal" href="#restore-and-return-rret">Restore and Return(RRET)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#glitching">Glitching</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
                <nav aria-label="Footer">
                    <ul class="nav justify-content-center mb-2">
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/features/">Features</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/about-wagtail/"> About Wagtail</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/services/"> Services</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/blog/"> Blog</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/packages/"> Packages</a></li>
                        
                            
                            
                            <li class="nav-item"><a class="nav-link text-light"  href="https://wagtail.org/developers/"> Developers</a></li>
                        
                    </ul>
                </nav>
            
            <div class="text-center">
                    &copy; Copyright 2024, Eljakim
            </div>
            <div class="text-center text-white-50 font-italic mt-3">
                <small>
                    Created using
                    <a href="https://github.com/wagtail/sphinx_wagtail_theme" rel="nofollow" target="_blank">
                        Sphinx Wagtail Theme 6.4.0
                    </a>
                    and
                    <a href="https://www.sphinx-doc.org/" rel="nofollow" target="_blank">
                        Sphinx 8.1.3
                    </a>
                </small>
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=9bcbadda"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="_static/copybutton.js?v=f281be69"></script>
        <script type="text/javascript" src="_static/dist/theme.js"></script>
        <script type="text/javascript" src="_static/dist/vendor.js"></script>
        <script type="text/javascript" src="_static/searchtools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() { Search.loadIndex("searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>